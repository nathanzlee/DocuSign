<!DOCTYPE html>
<html>
    <head>
        <link rel = "stylesheet" href = "/styles.css">
        <link rel = "stylesheet" href = "/index.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    </head>
    <body>
        <header>
            <div class="logo">
                <img src="/logo.png">
            </div>
        </header>
        <div class="wrapper">
            <button class="createTravelAuth">New Travel Authorization</button>
            <div class="travelAuthsList">
                <div class="travelAuthHeader">
                    <div id="requester">Requester</div>
                    <div id="manager">Manager</div>
                    <div id="reqDate">Date Requested</div>
                    <div id="approvedDate">Date Approved</div>
                    <div id="status">Status</div>
                </div>
                <!-- <div class="travelAuth">
                    <div class="requester"></div>
                    <div class="manager"></div>
                    <div class="reqDate"></div>
                    <div class="approvedDate"></div>
                    <div class="options"></div>
                </div> -->
            </div>
        </div>

        <script>
            // New travel auth
            const $newTravelAuth = document.querySelector('.createTravelAuth');

            function createTravelAuth() {
                location.href = '/travel/new'
            }

            $newTravelAuth.addEventListener('click', createTravelAuth);

            // Get travel auths
            function loadTravelAuths() {
                fetch('/info/user').then(res => res.json()).then(user => {
                    console.log(user);
                    const { firstName, lastName, managers, travelAuths } = user;
                    travelAuths.forEach(travelAuth => {
                        const $travelAuthList = document.querySelector('.travelAuthsList');
                        const $newAuth = document.createElement('div');
                        $newAuth.innerHTML = `
                            <div class="requester">${(firstName + " " + lastName == travelAuth.name) ? "You" : travelAuth.name}</div>
                            <div class="manager">${managers[0].firstName + " " + managers[0].lastName}</div>
                            <div class="reqDate">${(new Date(travelAuth.reqDate)).toLocaleDateString("en-US")}</div>
                            <div class="approvedDate"></div>
                            <div class="status"><div class="pending">Pending</div></div>
                            <div class="options"><button id="view">View</button></div>`;
                        $newAuth.className = "travelAuth";
                        $travelAuthList.appendChild($newAuth);

                        document.querySelector('#view').addEventListener('click', () => {
                            location.href = "/travelauth/" + travelAuth._id;
                        })
                        if (travelAuth.status == "approved") {

                        } else if (travelAuth.status == "pending") {

                        } else {

                        }
                    })
                })
            }

            loadTravelAuths();
        </script>
    </body>
</html>